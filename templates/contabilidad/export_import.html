{% extends 'contabilidad/menu.html' %}
{% load django_bootstrap5 %}

{% block title %}Exportar e Importar Datos{% endblock %}

{% block content %}

<div class="container">
    <center><h1 class="page-title mb-4">Exportar e Importar Datos</h1></center>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        <div class="col">
          <div class="card h-100 rounded shadow-sm">
            <div class="card-body">
              <p><h2 class="card-title"><center>Exportar</center></h2></p>
              <form method="get" id="exportForm" class="form-container">
                <div class="form-group mb-3">
                    <p><label for="model_name_export">Selecciona el modelo:</label></p>
                    <select id="model_name_export" name="model_name" class="form-select" onchange="updateExportAction(this.value)">
                        <option value="cuenta">Cuenta</option>
                        <option value="categoria">Categoría</option>
                        <option value="transaccion">Transacción</option>
                        <option value="presupuesto">Presupuesto</option>
                        <option value="ticketimagen">Ticket Imagen</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-download me-2"></i>Exportar Todos los Datos
                </button>
               </form> 
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100 rounded shadow-sm">
            <div class="card-body">
              <h2 class="card-title"><center>Importar</center></h2>
              <form method="post" enctype="multipart/form-data" id="importForm" class="form-container">
                {% csrf_token %}
                <div class="form-group">
                    <p><label for="model_name_import">Selecciona el modelo:</label></p>
                    <select id="model_name_import" name="model_name" class="form-select" onchange="updateImportAction(this.value)">
                        <option value="cuenta">Cuenta</option>
                        <option value="categoria">Categoría</option>
                        <option value="transaccion">Transacción</option>
                        <option value="presupuesto">Presupuesto</option>
                        <option value="ticketimagen">Ticket Imagen</option>
                    </select>
                </div>
                <div class="form-group file-input mb-3">
                    <p><label for="csv_file">Selecciona el archivo CSV:</label></p>
                    <input type="file" id="zip_file" name="csv_file" accept=".csv" required class="form-control">
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-upload me-2"></i>Importar
                </button>
              </form>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100 rounded shadow-sm">
            <div class="card-body">
              <h2 class="card-title"><center>Exportar/Importar Todo</center></h2>
              <div class="action-buttons">
                <form method="get" action="{% url 'contabilidad:export_all_to_csv' %}" class="form-container">
                    <button type="submit" class="btn btn-success w-100 mb-3">
                        <i class="fas fa-download me-2"></i>Exportar Todos los Datos
                    </button>
                </form>

                <form method="post" enctype="multipart/form-data" action="{% url 'contabilidad:import_all_from_csv' %}" class="form-container">
                    {% csrf_token %}
                    <div class="form-group file-input mb-3">
                        <p><label for="zip_file">Selecciona el archivo ZIP:</label></p>
                        <input type="file" id="zip_file" name="zip_file" accept=".zip" required class="form-control">
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                        <i class="fas fa-upload me-2"></i>Importar Todos los Datos
                    </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock %}
{% block js %}
    <script>
        function updateExportAction(modelName) {
            const form = document.getElementById('exportForm');
            form.action = `/export/${modelName}/`;
        }

        function updateImportAction(modelName) {
            const form = document.getElementById('importForm');
            form.action = `/import/${modelName}/`;
        }
    </script>
{% endblock %}