{% extends 'base.html' %}
{% load static %}

{% block title %}Tablero de Proyectos{% endblock %}

{% block content %}
<div class="container-fluid kanban-bg py-4">
    <div class="row mb-4 align-items-center">
        <div class="col">
            <h1 class="h3 fw-bold text-primary"><i class="fas fa-columns me-2"></i>Tablero de Proyectos</h1>
        </div>
        <div class="col-auto">
            <a href="{% url 'projects:project-create' %}" class="btn btn-success shadow-sm">
                <i class="fas fa-plus me-1"></i> Nuevo Proyecto
            </a>
        </div>
    </div>
    <div class="kanban-responsive-row">
        {% for status, projects in status_projects.items %}
        <div class="kanban-col d-flex align-items-stretch">
            <div class="card shadow-sm border-0 kanban-column w-100">
                <div class="card-header bg-light border-0 d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0 fw-semibold">
                        <span class="kanban-status-dot me-2" style="background: var(--bs-primary);"></span>
                        {{ status.name }}
                    </h5>
                    <span class="badge bg-secondary">{{ projects|length }}</span>
                </div>
                <div class="card-body p-2 kanban-cards">
                    {% for project in projects %}
                    <div class="card mb-3 project-card shadow-sm border-0">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="card-title mb-0 fw-bold text-truncate">
                                    <a href="{% url 'projects:project-detail' project.pk %}" class="text-decoration-none text-dark">
                                        <i class="fas fa-folder-open me-1 text-primary"></i>{{ project.title }}
                                    </a>
                                </h6>
                                <span class="badge bg-{{ project.priority.color }}">{{ project.priority.name }}</span>
                            </div>
                            <div class="mb-2 small text-muted">
                                <i class="fas fa-align-left me-1"></i>{{ project.description|truncatechars:40 }}
                            </div>
                            <div class="mb-2">
                                <span class="badge bg-light text-dark border border-1 me-1">
                                    <i class="fas fa-tasks me-1"></i>{{ project.tasks.count }} tareas
                                </span>
                                <span class="badge bg-light text-dark border border-1">
                                    <i class="fas fa-check-circle me-1"></i>{{ project.completion_percentage }}% completado
                                </span>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-success" role="progressbar" 
                                     style="width: {{ project.completion_percentage }}%" 
                                     aria-valuenow="{{ project.completion_percentage }}" aria-valuemin="0" aria-valuemax="100">
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center small">
                                <span>
                                    <i class="fas fa-calendar-alt me-1"></i>
                                    {% if project.start_date %}{{ project.start_date|date:"d/m/Y" }}{% else %}-{% endif %}
                                    <i class="fas fa-arrow-right mx-1"></i>
                                    {% if project.due_date %}{{ project.due_date|date:"d/m/Y" }}{% else %}-{% endif %}
                                </span>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light border-0" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="{% url 'projects:project-detail' project.pk %}"><i class="fas fa-eye me-2"></i>Ver detalles</a></li>
                                        <li><a class="dropdown-item" href="{% url 'projects:project-update' project.pk %}"><i class="fas fa-edit me-2"></i>Editar</a></li>
                                        <li><a class="dropdown-item text-danger" href="{% url 'projects:project-delete' project.pk %}" onclick="return confirm('¿Está seguro de eliminar este proyecto?')"><i class="fas fa-trash me-2"></i>Eliminar</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <div>No hay proyectos en este estado</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.kanban-bg {
    background: linear-gradient(135deg, #f8fafc 0%, #e9ecef 100%);
    min-height: 100vh;
}
.kanban-responsive-row {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    padding-bottom: 1rem;
}
.kanban-col {
    flex: 1 1 20%;
    max-width: 20%;
    min-width: 0;
    display: flex;
    align-items: stretch;
}
.kanban-column {
    background: #fff;
    border-radius: 1rem;
    min-height: 60vh;
    display: flex;
    flex-direction: column;
    width: 100%;
}
.kanban-status-dot {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--bs-primary);
}
.kanban-cards {
    flex: 1 1 auto;
    overflow-y: auto;
    max-height: 70vh;
}
.project-card {
    border-radius: 0.75rem;
    transition: box-shadow 0.2s, transform 0.2s;
    cursor: pointer;
}
.project-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.10);
    transform: translateY(-2px) scale(1.01);
}
.card-title a {
    color: inherit;
    text-decoration: none;
}
.card-title a:hover {
    color: #0d6efd;
    text-decoration: underline;
}
@media (max-width: 1200px) {
    .kanban-col { min-width: 220px; max-width: 260px; flex: 1 1 260px; }
}
@media (max-width: 992px) {
    .kanban-col { min-width: 260px; max-width: 320px; flex: 1 1 320px; }
}
@media (max-width: 768px) {
    .kanban-col { min-width: 90vw; max-width: 95vw; width: 95vw; flex: 1 1 95vw; }
    .kanban-cards { max-height: 30vh; }
    .project-card { padding: 0.5rem; }
    .card-title a { font-size: 1rem; }
}
@media (max-width: 480px) {
    .kanban-col { min-width: 98vw; max-width: 99vw; width: 99vw; flex: 1 1 99vw; }
    .kanban-cards { max-height: 20vh; }
}
</style>
{% endblock %}